# Drizzle, Auth & PDF Integration Walkthrough

This walkthrough details the integration of Drizzle ORM, Better Auth, and PDF Generation into the Invoice Generator.

## Changes Implemented

### Dependencies
- Installed `drizzle-orm`, `drizzle-kit`, `better-auth`, `@better-auth/cli`.

### Configuration
- **`drizzle.config.ts`**: Configured Drizzle Kit for SQLite.
- **`wrangler.toml`**: Added `PDF_GENERATION_URL` to `[vars]`.
- **`src/lib/server/schema.ts`**: Defined Drizzle schema.
- **`src/lib/server/auth.ts`**: Configured Better Auth.
- **`src/lib/auth.ts`**: Configured Better Auth client.

### Backend Logic
- **`src/lib/server/db.ts`**: Refactored to use Drizzle ORM.
- **`src/routes/api/auth/[...all]/+server.ts`**: Added Better Auth API handlers.
- **`src/routes/api/invoices/+server.ts`**: Protected endpoints.
- **`src/routes/api/pdf/+server.ts`**: New endpoint to proxy PDF generation requests.

### Frontend Integration
- **`src/components/Header.svelte`**: Added Auth controls.
- **`src/routes/+page.svelte`**: Updated "Download PDF" to use server-side generation for logged-in users.

## Setup Instructions

> [!IMPORTANT]
> **Database Migration**: You MUST run the following commands to apply the new schema.

1.  **Generate Migrations**:
    ```bash
    npx drizzle-kit generate
    ```

2.  **Apply Migrations (Local)**:
    ```bash
    npx wrangler d1 migrations apply invoice-db --local
    ```

3.  **Environment Variables**:
    Ensure your `.env` or `wrangler.toml` has:
    - `GOOGLE_CLIENT_ID`
    - `GOOGLE_CLIENT_SECRET`
    - `BETTER_AUTH_SECRET`
    - `PDF_GENERATION_URL` (e.g., `https://your-pdf-service.com/generate`)

## Verification

1.  **Start Development Server**:
    ```bash
    npm run dev
    ```
2.  **Test Auth**:
    - Sign In with Google.
3.  **Test PDF Generation**:
    - **As Guest**: Click "Download PDF". It should use the browser-based generator.
    - **As User**: Log in. Click "Download PDF". It should call `/api/pdf` and download the file generated by your external service.
